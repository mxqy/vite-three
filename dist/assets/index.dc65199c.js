import{A as k,P as z,S as B,T as O,M as _,B as x,a as w,b as T,c as F,G,d as W,e as R,f as V,g as N,h as $,C as I,i as U,j as C,W as Y,k as K,l as J,V as y,m as Q,n as X,o as Z,p as ee,q as te,O as se,r as oe,s as ie,t as ne,u as ae,v as re,w as de,x as he}from"./vendor.ae15ec18.js";const ce=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))c(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const p of i.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&c(p)}).observe(document,{childList:!0,subtree:!0});function d(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerpolicy&&(i.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?i.credentials="include":t.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function c(t){if(t.ep)return;t.ep=!0;const i=d(t);fetch(t.href,i)}};ce();const M=[],le=new k("rgb(255,255,255)",.5),ue=new z(16711680,.7,20,.1);ue.position.set(10,10,8);const e=new B(16777215,.4,200,Math.PI/180*30);e.position.set(-30,30,-30);e.castShadow=!0;e.decay=.1;e.shadow.mapSize.width=512;e.shadow.mapSize.height=512;e.shadow.camera.near=10;e.shadow.camera.far=200;e.shadow.focus=1;M.push(le,e);const b=new O,v=b.load("https://mxqy2307-1303879355.cos.ap-guangzhou.myqcloud.com/img/miku.jpg"),pe=b.load("https://mxqy2307-1303879355.cos.ap-guangzhou.myqcloud.com/img/rain.png"),H=[];let h={box:new _(new x(10,10,10),new w({map:v,roughness:.3})),plane:new _(new T(1527,1080),new w({map:v})),stage:new _(new x(200,10,200),new w({color:"rgb(150,150,150)",roughness:0}))};h.box.position.y=-8,h.box.position.x=20,h.box.castShadow=!0,h.box.render=!0;h.plane.scale.set(.05,.05,.05),h.plane.position.y=50,h.plane.render=!1;h.stage.receiveShadow=!0,h.stage.position.y=-18,h.stage.render=!0;const L=new F;L.scale.setScalar(45e4);H.push(L);var g=new G;const me=new W({map:pe});function A(){if(g.children.length>f||g.children.length==f)g.children.length=f;else for(let c=0;c<f-g.children.length;c++){let t=new R(me);var a=Math.random()-.5,o=Math.random()-.5,d=Math.random()-.5;t.position.set(200*a,200*d,200*o),g.add(t)}}A();for(let a in h)h[a].render&&H.push(h[a]);const S=[],ge=new V(500);ge.position.y=-13;const P=new N(500,20,"rgb(200,200,200)","rgb(100,100,100)");P.position.y=-13;const E=new $(e,e.color),q=new I(e.shadow.camera);var f=0,fe=!1,_e=50;S.push(P,E,q);class we{constructor(o,d,c,t,i,p){this.gui=new U,this._renderer=o,this._scene=c,this._camera=t;const n={\u96E8\u6EF4\u6570\u91CF:f},l={PLAY:fe,\u97F3\u91CF:_e};this.gui.add(l,"PLAY").onChange(s=>{p(s)}),this.gui.add(l,"\u97F3\u91CF",0,100).onChange(s=>{i(Math.floor(s)/100)}),this.gui.add(n,"\u96E8\u6EF4\u6570\u91CF",0,5e3).onChange(s=>{this._scene.remove(g),f=Math.floor(s),A(),this._scene.add(g)}),this.spotLightHelper=this.gui.addFolder("\u805A\u5149\u706F");const u={\u989C\u8272:e.color.getHex(),\u5F3A\u5EA6:e.intensity,\u8DDD\u79BB:e.distance,\u89D2\u5EA6:e.angle,\u534A\u5F71\u8870\u51CF:e.penumbra,\u8DDD\u79BB\u8870\u51CF:e.decay,\u9634\u5F71\u8303\u56F4:e.shadow.focus};this.spotLightHelper.addColor(u,"\u989C\u8272").onChange(function(s){e.color.setHex(s)}),this.spotLightHelper.add(u,"\u5F3A\u5EA6",0,2).onChange(function(s){e.intensity=s}),this.spotLightHelper.add(u,"\u8DDD\u79BB",50,200).onChange(function(s){e.distance=s}),this.spotLightHelper.add(u,"\u89D2\u5EA6",0,Math.PI/3).onChange(function(s){e.angle=s}),this.spotLightHelper.add(u,"\u534A\u5F71\u8870\u51CF",0,1).onChange(function(s){e.penumbra=s}),this.spotLightHelper.add(u,"\u8DDD\u79BB\u8870\u51CF",.1,2).onChange(function(s){e.decay=s}),this.spotLightHelper.add(u,"\u9634\u5F71\u8303\u56F4",0,1).onChange(function(s){e.shadow.focus=s}),this.sunHelper=this.gui.addFolder("\u592A\u9633");const r={\u6D51\u6D4A\u5EA6:3,\u745E\u5229\u6563\u5C04:3,\u7C73\u6C0F\u7CFB\u6570:.005,\u7C73\u6C0F\u65B9\u5411:.7,\u592A\u9633\u9AD8\u5EA6:2,\u592A\u9633\u65B9\u4F4D:180,\u66DD\u5149\u7EA7\u522B:this._renderer.toneMappingExposure},m=()=>{const s=L.material.uniforms;s.turbidity.value=r.\u6D51\u6D4A\u5EA6,s.rayleigh.value=r.\u745E\u5229\u6563\u5C04,s.mieCoefficient.value=r.\u7C73\u6C0F\u7CFB\u6570,s.mieDirectionalG.value=r.\u7C73\u6C0F\u65B9\u5411;const D=C.degToRad(90-r.\u592A\u9633\u9AD8\u5EA6),j=C.degToRad(r.\u592A\u9633\u65B9\u4F4D);d.setFromSphericalCoords(1,D,j),s.sunPosition.value.copy(d),this._renderer.toneMappingExposure=r.\u66DD\u5149\u7EA7\u522B,this._renderer.render(this._scene,this._camera)};this.sunHelper.add(r,"\u6D51\u6D4A\u5EA6",0,20,.1).onChange(m),this.sunHelper.add(r,"\u745E\u5229\u6563\u5C04",0,4,.001).onChange(m),this.sunHelper.add(r,"\u7C73\u6C0F\u7CFB\u6570",0,.1,.001).onChange(m),this.sunHelper.add(r,"\u7C73\u6C0F\u65B9\u5411",0,1,.001).onChange(m),this.sunHelper.add(r,"\u592A\u9633\u9AD8\u5EA6",0,90,.1).onChange(m),this.sunHelper.add(r,"\u592A\u9633\u65B9\u4F4D",-180,180,.1).onChange(m),this.sunHelper.add(r,"\u66DD\u5149\u7EA7\u522B",0,2,1e-4).onChange(m),m()}}class ye{constructor(o){this._dom=o,this._renderer=new Y({antialias:!0}),this._renderer.shadowMap.enabled=!0,this._scene=new K,this._camera=new J(45,o.offsetWidth/o.offsetHeight,1,2e3),this._camera.position.set(100,100,100),this._camera.lookAt(new y(0,0,0)),this._camera.up=new y(0,1,0),this._sun=new y,this._clock=new Q,this._loader=new X,this._listener=new Z,this._MMDHelper=new ee,this._audioLoader=new te,this._isPlay=!1,this._renderer.setSize(this._dom.offsetWidth,this._dom.offsetHeight);const d=new se(this._camera,this._renderer.domElement);d.enableDamping=!0,this.onWindowResize=()=>{this._camera.aspect=this._dom.offsetWidth/this._dom.offsetHeight,this._camera.updateProjectionMatrix(),this._renderer.setSize(this._dom.offsetWidth,this._dom.offsetHeight)};const c="https://mxqy2307-1303879355.cos.ap-guangzhou.myqcloud.com/mmd/keqing2/%E5%88%BB%E6%99%B4.pmx",t="https://mxqy2307-1303879355.cos.ap-guangzhou.myqcloud.com/mmd/action/jljt.vmd",i="https://mxqy2307-1303879355.cos.ap-guangzhou.myqcloud.com/mmd/music/GARNiDELiA%20-%20%E6%A5%B5%E6%A5%BD%E6%B5%84%E5%9C%9F.mp3";this._loader.load(c,n=>{this._loader.loadAnimation(t,n,l=>{this._MMDHelper.add(n,{animation:l}),this._camera.add(this._listener),this._audioLoader.load(i,u=>{this._audio=new oe(this._listener).setBuffer(u),this._audio.setVolume(.5),this._MMDHelper.add(this._audio,{delayTime:2*60+1}),n.castShadow=!0,n.position.y=-13,this._scene.add(n),this._ready=!0})})}),this.audioPlay=n=>{n?(this._audio.play(),this._isPlay=!0):(this._audio.pause(),this._isPlay=!1)},this.setVolume=n=>{this._audio.setVolume(n)},new we(this._renderer,this._sun,this._scene,this._camera,this.setVolume,this.audioPlay);const p=()=>{E.update(),q.update(),d.update();const n=this._clock.getDelta();this._ready&&this._isPlay&&this._MMDHelper.update(n),g.children.forEach(l=>{l.position.y-=1,l.position.y<-15&&(l.position.y+=200)}),this._renderer.render(this._scene,this._camera),requestAnimationFrame(p)};p(),o.appendChild(this._renderer.domElement),this.addObject=(...n)=>{n.forEach(l=>{this._scene.add(l)})}}}var He=(a,o)=>{const d=a.__vccOpts||a;for(const[c,t]of o)d[c]=t;return d};const Le=ie({setup(){const a=ne(null);return ae(()=>{const o=new ye(a.value);o.addObject(...H),o.addObject(...M),o.addObject(...S),window.onresize=()=>{o.onWindowResize()}}),{threeTarget:a}}}),xe={class:"box",ref:"threeTarget"};function Ce(a,o,d,c,t,i){return de(),re("div",xe,null,512)}var Me=He(Le,[["render",Ce]]);he(Me).mount("#app");
